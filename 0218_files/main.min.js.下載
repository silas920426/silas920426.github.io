$(function(){$(window).one("destroy",function(){window.boards.forEach(function(t){t.systemReset()})})}),function(){let t={},e=10,s={demoMonster01:{x:1,y:1},demoMonster02:{x:1,y:1},demoMonster03:{x:1,y:1},demoMonster04:{x:1,y:1}};const a=document.querySelectorAll(".monster"),r=document.getElementById("bg");window.$bg=r;const n=()=>{let s=window.innerWidth,r={demoMonster01:10,demoMonster02:.33*s-30,demoMonster03:.66*s-70,demoMonster04:s-110},n={};localStorage.monsterData&&!(t=>{o=JSON.parse(t);for(let t in o)return!1;return!0})(localStorage.monsterData)?(t=JSON.parse(localStorage.monsterData),a.forEach(o=>{let s=o.getAttribute("id");window[`$${s}`]=o,t[s]?n[s]=t[s]:(n[s]={x:r[s],y:25,z:10,deg:0,size:90,display:"block"},t[s]=n[s]),(e=t.z)<10&&(e=10)})):a.forEach(o=>{let s=o.getAttribute("id");window[`$${s}`]=o,n[s]={x:r[s],y:25,z:10,deg:0,size:90,display:"block"},t[s]=n[s],t.z=10,e=10}),a.forEach(t=>{let e=t.getAttribute("id");t.style.left=`${n[e].x}px`,t.style.bottom=`${n[e].y}px`,t.style.width=`${n[e].size}px`,t.style.height=`${n[e].size}px`,t.style.zIndex=n[e].z,t.style.display=n[e].display,t.querySelector(".m-img").style.transform=`rotate(${n[e].deg}deg`,t.querySelector("span").innerHTML.length>0&&t.classList.add("hasMsg")}),localStorage.monsterData=JSON.stringify(t),window.monsterReady=!0};n();let i,l={};window.$mouseX=window.innerWidth/2,window.$mouseY=window.innerHeight/2;let d,g,m,f,c=!1;const h=t=>({height:t.offsetHeight,width:t.offsetWidth,left:t.offsetLeft,right:t.offsetLeft+t.offsetWidth,top:t.offsetTop,bottom:t.offsetTop+t.offsetHeight,cx:t.offsetLeft+t.offsetWidth/2,cy:window.innerHeight-t.offsetTop-t.offsetHeight/2,top2:window.innerHeight-t.offsetTop,bottom2:window.innerHeight-t.offsetTop-t.offsetHeight,oy:t.offsetTop+t.offsetHeight/2,z:+t.style.zIndex}),y=t=>{if(!t.toElement.classList.contains("talk")){let e=t.changedTouches;if(window.$mouse=e?{x:~~e[0].pageX,y:~~e[0].pageY}:{x:event.pageX,y:event.pageY},window.$mouseX=window.$mouse.x,window.$mouseY=window.innerHeight-window.$mouse.y,l.x=window.$mouse.x,l.y=window.$mouse.y,c){let t=window.innerHeight;m=l.x+d,f=t-(l.y+g),i.classList.add("dragging"),i.style.left=m+"px",i.style.bottom=f+"px"}}},u=function(t){if(!t.toElement.classList.contains("talk")){let o=t.changedTouches;window.$mouse=o?{x:~~o[0].pageX,y:~~o[0].pageY}:{x:event.pageX,y:event.pageY},l.x=window.$mouse.x,l.y=window.$mouse.y;let s=this,a=h(s);c=!0,i=s;let r=s.getAttribute("id"),n=JSON.parse(localStorage.monsterData);e++,n[r].z=e,n.z=e,s.style.zIndex=e,d=a.left-l.x,g=a.top-l.y+a.height,m=0,f=0,localStorage.monsterData=JSON.stringify(n)}};a.forEach(t=>{t.addEventListener("touchmove",y),t.addEventListener("mousedown",u),t.addEventListener("touchstart",u),t.addEventListener("touchend",function(){c=!1;let t=JSON.parse(localStorage.monsterData),e=this.getAttribute("id");this.classList.remove("dragging"),0!=m&&(t[e].x=m),0!=f&&(t[e].y=f),localStorage.monsterData=JSON.stringify(t)})}),document.addEventListener("mouseup",()=>{if(c=!1,i){let t=JSON.parse(localStorage.monsterData),e=i.getAttribute("id");i.classList.remove("dragging"),0!=m&&(t[e].x=m),0!=f&&(t[e].y=f),localStorage.monsterData=JSON.stringify(t)}}),document.addEventListener("mousemove",y),document.getElementById("reset").addEventListener("click",()=>{localStorage.removeItem("monsterData"),a.forEach(t=>{t.querySelector(".talk").innerHTML="",t.classList.remove("hasMsg")}),n()}),a.forEach(t=>{let o=t,a=o.getAttribute("id");o.talk=(t=>{let e=t+"",s=e.toLowerCase(),a=o.querySelector(".talk");o.classList.add("hasMsg"),e.length>0?s.includes(".png")||s.includes(".jpg")||s.includes(".gif")||s.includes("googleusercontent.com")?a.innerHTML=`<img src="${e}">`:a.innerHTML=e:(a.innerHTML="",o.classList.remove("hasMsg"))}),o.emotion=(t=>{let e=o.querySelector(".m-img");if("random"!=t)e.setAttribute("attr-emotion",t);else{let t=["0","1","2","3","4"][~~(5*Math.random())];e.setAttribute("attr-emotion",t)}}),o.move=((t,e)=>{let r,n,i=JSON.parse(localStorage.monsterData),d=h(o),g={},m=s[a].x,f=s[a].y;g.top=(()=>{r=d.left,n=d.bottom2+e*f}),g.bottom=(()=>{r=d.left,n=d.bottom2-e*f}),g.left=(()=>{r=d.left-e*m,n=d.bottom2}),g.right=(()=>{r=d.left+e*m,n=d.bottom2}),g.random=(()=>{let t=~~(4*Math.random());g[["top","bottom","left","right"][t]]()}),g.mouse=(()=>{let t=Math.abs(l.x-d.cx),o=Math.abs(l.y-d.cy),s=Math.round(Math.atan(o/t)/Math.PI*180);r=d.left,d.cx>l.x+10?r=d.left-Math.round(e*Math.cos(s/180*Math.PI)):d.cx<l.x-10&&(r=d.left+Math.round(e*Math.cos(s/180*Math.PI))),n=d.bottom2,d.oy>l.y+10?n=d.bottom2+Math.round(e*Math.sin(s/180*Math.PI)):d.oy<l.y-10&&(n=d.bottom2-Math.round(e*Math.sin(s/180*Math.PI)))}),g[t](),o.style.left=`${r}px`,o.style.bottom=`${n}px`,i[a].x=r,i[a].y=n,localStorage.monsterData=JSON.stringify(i)}),o.moveTo=((t,e)=>{let s=JSON.parse(localStorage.monsterData),r=t-o.offsetWidth/2,n=e-o.offsetHeight/2;o.style.left=`${r}px`,o.style.bottom=`${n}px`,s[a].x=r,s[a].y=n,localStorage.monsterData=JSON.stringify(s)}),o.rebound=(()=>{let t=h(o),e=window.innerWidth,r=window.innerHeight;t.left<0&&(s[a].x=-1*s[a].x,o.moveTo(t.width/2,t.cy)),t.right>e&&(s[a].x=-1*s[a].x,o.moveTo(e-t.width/2,t.cy)),t.top<0&&(s[a].y=-1*s[a].y,o.moveTo(t.cx,r-t.height/2+1)),t.bottom>r&&(s[a].y=-1*s[a].y,o.moveTo(t.cx,t.height/2-1))}),o.x=(()=>o.offsetLeft+o.offsetWidth/2),o.y=(()=>window.innerHeight-o.offsetTop-o.offsetHeight/2),o.width=(()=>o.offsetWidth),o.height=(()=>o.offsetHeight),o.deg=(()=>{let t=JSON.parse(localStorage.monsterData)[a].deg;return Math.round(100*t)/100}),o.rotate=((t,e)=>{let s,r=JSON.parse(localStorage.monsterData);switch(t){case"left":s=r[a].deg-e;break;case"right":s=r[a].deg+e}r[a].deg=s,o.querySelector(".m-img").style.transform="rotate("+s+"deg)",localStorage.monsterData=JSON.stringify(r)}),o.faceTo=(t=>{let e=JSON.parse(localStorage.monsterData);o.querySelector(".m-img").style.transform="rotate("+t+"deg)",e[a].deg=t,localStorage.monsterData=JSON.stringify(e)}),o.faceToMouse=(t=>{if("auto"===t){let t,e,s=JSON.parse(localStorage.monsterData),r=s[a].x+o.offsetWidth/2,n=window.innerHeight-s[a].y-o.offsetHeight/2;window.$mouse?(t=window.$mouse.x,e=window.$mouse.y):(t=-1,e=-1);let i=Math.atan2(t-r,e-n)*(180/Math.PI)*-1+90;o.querySelector(".m-img").style.transform="rotate("+i+"deg)",s[a].deg=i,localStorage.monsterData=JSON.stringify(s)}}),o.size=((t,e)=>{let s,r,n,i=h(o),l=JSON.parse(localStorage.monsterData);switch(t){case"big":s=i.width+e,r=i.left-e/2,n=i.bottom2-e/2;break;case"small":s=i.width-e,r=i.left+e/2,n=i.bottom2+e/2}o.style.width=s+"px",o.style.height=s+"px",o.style.left=r+"px",o.style.bottom=n+"px",l[a].size=s,l[a].x=r,l[a].y=n,localStorage.monsterData=JSON.stringify(l)}),o.sizeTo=(t=>{let e=JSON.parse(localStorage.monsterData),s=t/100*90,r=e[a].size-s,n=e[a].x+r/2,i=e[a].y+r/2;o.style.width=s+"px",o.style.height=s+"px",o.style.left=n+"px",o.style.bottom=i+"px",e[a].size=s,e[a].x=n,e[a].y=i,localStorage.monsterData=JSON.stringify(e)}),o.display=(t=>{let e=JSON.parse(localStorage.monsterData);switch(t){case"show":o.style.display="block",e[a].display="block";break;case"hide":o.style.display="none",e[a].display="none"}localStorage.monsterData=JSON.stringify(e)}),o.reset=(()=>{let t=JSON.parse(localStorage.monsterData);delete t[a],localStorage.monsterData=JSON.stringify(t),n()}),o.toTop=(()=>{let t,s=JSON.parse(localStorage.monsterData);t=s.z?s.z+1:11,o.style.zIndex=t,s[a].z=t,s.z=t,e=t,localStorage.monsterData=JSON.stringify(s)}),o.toBottom=(()=>{let t=JSON.parse(localStorage.monsterData),e=[t.demoMonster01.z,t.demoMonster02.z,t.demoMonster03.z,t.demoMonster04.z],s=Math.min.apply(null,e)-1;o.style.zIndex=s,t[a].z=s,localStorage.monsterData=JSON.stringify(t)}),o.click=(t=>{o.addEventListener("click",t)}),o.hover=((t,e)=>{o.addEventListener("mouseenter",t),o.addEventListener("mouseout",e)}),o.collision=((t,e)=>{let s=o.offsetLeft,a=o.offsetTop,r=s+o.offsetWidth,n=a+o.offsetHeight,i=t.offsetLeft,l=t.offsetTop,d=t.offsetWidth,g=t.offsetHeight;n-7<l+7||a+7>l+g-7||r-7<i+7||s+7>i+d-7||e()}),o.stage=((t,e)=>{let s=r.width(),a=r.height(),n=o.offsetLeft,i=o.offsetTop,l=o.offsetWidth,d=o.offsetHeight,g=n+l,m=i+d,f={edge:()=>{(n<=0||g>=s||i<=0||m>=a)&&e()},topOrBottom:()=>{(i<=0||m>=a)&&e()},letOrRight:()=>{(n<=0||g>=s)&&e()},top:()=>{i<=0&&e()},bottom:()=>{m>=a&&e()},left:()=>{n<=0&&e()},right:()=>{g>=s&&e()}};f[t]()})}),r.color=(t=>{r.innerHTML="",r.style.background=t}),r.image=(t=>{r.innerHTML=`<img src="${t}">`}),r.fullScreen=(()=>{const t=window.parent.document.getElementById("demo-area"),e=window.parent.document.getElementById("demo-resize-btn");e&&-1==t.className.indexOf("max")&&e.click()}),r.width=(()=>r.offsetWidth),r.height=(()=>r.offsetHeight);let w={};window.$sound=w,w.play=(t=>{let e=document.querySelector(`.sound.${t}`),o=e.getAttribute("data-src");o&&(e.setAttribute("src",o),e.removeAttribute("data-src")),e.pause(),e.currentTime=0,e.play()}),w.random=(t=>{let e=document.querySelectorAll(`#sound0${t} .sound`),o=e[~~(Math.random()*e.length)],s=o.getAttribute("data-src");s&&(o.setAttribute("src",s),o.removeAttribute("data-src")),o.pause(),o.currentTime=0,o.play()})}();